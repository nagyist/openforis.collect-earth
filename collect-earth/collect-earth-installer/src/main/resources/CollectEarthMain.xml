<component>
    <name>CollectEarthMainComponent</name>
    <description>CollectEarth</description>
    <canBeEdited>1</canBeEdited>
    <selected>1</selected>
    <show>1</show>
    <desktopShortcutList>
        <shortcut>
            <comment>Start Collect Earth</comment>
            <exec>${installdir}/CollectEarth-launcher.run</exec>
            <icon>${installdir}/launcher_logo.png</icon>
            <name>Collect Earth</name>
            <path></path>
            <platforms>all</platforms>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/CollectEarth-launcher.exe</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon>${installdir}/launcher_icon.ico</windowsIcon>
            <windowsPath></windowsPath>
        </shortcut>
    </desktopShortcutList>
    <folderList>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfiles</name>
            <platforms>all</platforms>
            <distributionFileList>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/src/main/resources/images</origin>
                </distributionDirectory>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/target/earth-libs</origin>
                </distributionDirectory>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/target/CollectEarth.jar</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/disclaimer.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/README.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/License.txt</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/UserManual.pdf</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/CHANGELOG.md</origin>
                </distributionFile>
                <distributionFile>
                    <origin>earth.properties_initial</origin>
                </distributionFile>
                <distributionFile>
                    <origin>earth.properties_forced_update</origin>
                </distributionFile>
                <distributionFile>
                    <origin>update.ini</origin>
                </distributionFile>
            </distributionFileList>
            <shortcutList>
                <shortcut>
                    <comment>Uninstall</comment>
                    <exec>${installdir}/${uninstallerName}</exec>
                    <icon></icon>
                    <name>Uninstall ${product_fullname}</name>
                    <path>${installdir}</path>
                    <platforms>all</platforms>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </shortcut>
            </shortcutList>
        </folder>
		<folder>
            <description>Resources Windows</description>
            <destination>${installdir}/resources</destination>
            <name>resourceswindows</name>
            <platforms>windows windows-x64</platforms>
            <distributionFileList>
	         	<distributionDirectory  allowWildcards="1">
	            	<origin>../../../collect-earth-app/resources/*</origin>
	            </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Resources Linux 64</description>
            <destination>${installdir}/resources</destination>
            <name>resourceslinux64</name>
            <platforms>linux-x64</platforms>
            <distributionFileList>
	         	<distributionDirectory  allowWildcards="1">
	            	<origin>../../../collect-earth-app/resources/*</origin>
	            </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Resources Linux 32</description>
            <destination>${installdir}/resources</destination>
            <name>resourceslinux32</name>
            <platforms>linux</platforms>
            <distributionFileList>
	         	<distributionDirectory  allowWildcards="1">
	            	<origin>../../../collect-earth-app/resources/*</origin>
	            </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Resources Mac</description>
            <destination>${installdir}/resources</destination>
            <name>resourcesosx</name>
            <platforms>osx</platforms>
            <distributionFileList>
	         	<distributionDirectory allowWildcards="1">
	            	<origin>../../../collect-earth-app/resources/*</origin>
	            </distributionDirectory>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux</name>
            <platforms>linux</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_logo.png</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate.run</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileslinux64</name>
            <platforms>linux-x64</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_logo.png</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate-x64.run</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileswindows64</name>
            <platforms>windows-x64</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_icon.ico</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate-x64.exe</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfileswindows</name>
            <platforms>windows</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_icon.ico</origin>
                </distributionFile>
                <distributionFile>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate.exe</origin>
                </distributionFile>
            </distributionFileList>
        </folder>
        <folder>
            <description>Program Files</description>
            <destination>${installdir}</destination>
            <name>programfilesosx</name>
            <platforms>osx</platforms>
            <distributionFileList>
                <distributionFile>
                    <origin>launcher_icons.icns</origin>
                </distributionFile>
                <distributionDirectory>
                    <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-app/autoupdate/autoupdate.app</origin>
                </distributionDirectory>
            </distributionFileList>
        </folder>
    </folderList>
    <initializationActionList>
        <setInstallerVariable>
            <name>java_launcher_jar</name>
            <progressText>Creating Launcher</progressText>
            <value>CollectEarth.jar</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>java_create_launcher</name>
            <progressText>Creating Launcher setting</progressText>
            <value>1</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>java_launcher_binary_name</name>
            <progressText>Set launcher name</progressText>
            <value>CollectEarth-launcher.${platform_exec_suffix}</value>
        </setInstallerVariable>
         <if>
        	<actionList>
        		<setInstallerVariable>
        			<name>default_installdir</name>
        			<value>${env(SYSTEMDRIVE)}/OpenForis/${product_shortname}</value>
        		</setInstallerVariable>
        	</actionList>
        	<conditionRuleList>
        		<platformTest>
        			<type>windows-x64</type>
        		</platformTest>
			</conditionRuleList>
			<elseActionList>
				<setInstallerVariable>
					<name>default_installdir</name>
					<value>~/OpenForis/${product_shortname}</value>
				</setInstallerVariable>
			</elseActionList>
		</if>
    </initializationActionList>

    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${default_installdir}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
        </directoryParameter>
    </parameterList>
    <!--
    Change installer icon on OS X, during build time
    REMOVED Because it causes the installer not to match the signature of the installer and Monterey complains
    <postBuildActionList>
        <copyFile>
            <destination>${installbuilder_output_filename}/Contents/Resources/installbuilder.icns</destination>
            <origin>COLLECT_EARTH_MAIN_FOLDER/collect-earth-installer/src/main/resources/installer_icon.icns</origin>
            <ruleList>
				<platformTest type="osx"/>
   			</ruleList>
        </copyFile>
    </postBuildActionList>
    -->
    <preInstallationActionList>
        <deleteFile>
        	<path>${installdir}/java</path>
        	<progressText>Removing old JRE</progressText>
        	<abortOnError>0</abortOnError>
        </deleteFile>
        <deleteFile>
        	<path>${installdir}/tmp</path>
        	<progressText>Removing old updaters</progressText>
        	<abortOnError>0</abortOnError>
        </deleteFile>

    </preInstallationActionList>
    <postInstallationActionList>
        <substitute>
            <files>${installdir}/earth.properties_initial;${installdir}/earth.properties_forced_update</files>
            <type>regexp</type>
            <substitutionList>
                <substitution>
                    <pattern>install_directory</pattern>
                    <value>${installdir}</value>
                </substitution>
                <substitution>
                    <pattern>INSTALLATION_LANGUAGE</pattern>
                    <value>${installation_language_code}</value>
                </substitution>
            </substitutionList>
        </substitute>

        <changePermissions>
            <files>${installdir}/${java_launcher_binary_name};${installdir}/*.log;${installdir}/*.properties;${installdir}/generated;${installdir}/*.db;${installdir}/*.dbSaiku</files>
            <permissions>0777</permissions>
        </changePermissions>

		<changePermissions>
			<files>${installdir}/*.app/Contents/MacOS/*</files>
			<permissions>0755</permissions>
			<ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
		</changePermissions>

        <createSymLink>
            <linkName>~/Desktop/Collect Earth.app</linkName>
            <target>${installdir}/${java_launcher_binary_name}</target>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </createSymLink>
        <associateWindowsFileExtension>
            <extensions>.cep</extensions>
            <friendlyName>Collect Earth Project file</friendlyName>
            <icon>${installdir}\launcher_icon.ico</icon>
            <mimeType>application/vnd.openforis.collectearth</mimeType>
            <progID>openforis.collectearth.1</progID>
            <commandList>
                <!-- Defining the 'Open' command -->
                <command>
                    <makeDefault>0</makeDefault>
                    <runProgram>${installdir}\${java_launcher_binary_name}</runProgram>
                    <runProgramArguments>"%1"</runProgramArguments>
                    <verb>Open</verb>
                </command>
            </commandList>
        </associateWindowsFileExtension>


        <!-- Restart the launch services to reload the configuration (Mac OS X)-->
        <runProgram>
        	<abortOnError>0</abortOnError>
            <program>/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/LaunchServices.framework/Versions/A/Support/lsregister</program>
            <programArguments>-kill -domain local -domain system -domain user</programArguments>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </runProgram>

        <!-- Make sure that Collect Earth runs properly n 4K displays by disabling the High DPI feature -->
         <registrySet>
	      <type>REG_SZ</type>
	      <value>~ HIGHDPIAWARE</value>
	      <key>HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Layers</key>
	      <name>${installdir}\${java_launcher_binary_name}</name>
	      <ruleList>
                <platformTest>
                    <type>windows-x64</type>
                </platformTest>
            </ruleList>
		</registrySet>


		<copyFile>
            <origin>${installdir}/launcher_icons.icns</origin>
            <destination>${installdir}/${java_launcher_binary_name}/Contents/Resources/installbuilder.icns</destination>
            <ruleList>
				<platformTest type="osx"/>
   			</ruleList>
        </copyFile>


    </postInstallationActionList>
    <startMenuShortcutList>
        <startMenuShortcut>
            <comment>Uninstall ${product_fullname}</comment>
            <name>Uninstall ${product_fullname}</name>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
            <windowsExecArgs></windowsExecArgs>
            <windowsIcon></windowsIcon>
            <windowsPath>${installdir}/</windowsPath>
        </startMenuShortcut>
        <startMenuFileShortcut>
            <comment>Collect Earth User's Manual</comment>
            <filePath>${installdir}/UserManual.pdf</filePath>
            <name>User Manual</name>
            <runAsAdmin>0</runAsAdmin>
            <runInTerminal>0</runInTerminal>
            <windowsIcon></windowsIcon>
        </startMenuFileShortcut>
    </startMenuShortcutList>
</component>